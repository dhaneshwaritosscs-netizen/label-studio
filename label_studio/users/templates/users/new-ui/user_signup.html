{% extends 'users/new-ui/user_base.html' %}
{% load static %}

{% block content %}
  {{ block.super }}
  <script nonce="{{request.csp_nonce}}">
    gaClientIdTrackingIframe('users.signup.view');
    // Give time for `ls_gaclient_id` to be set
    setTimeout(() => {
      const ls_gaclient_id = sessionStorage.getItem('ls_gaclient_id');
      __lsa('users.signup.view', { ls_gaclient_id });
    }, 2000);
  </script>
{% endblock %}

{% block user_content %}

  
  <!-- Form Container -->
  <div class="form-container">
    <form id="signup-form"
        action="{% url 'user-signup' %}?next={{ next }}{% if token %}&token={{ token }}{% endif %}"
        method="post"
    >
    {% csrf_token %}
      <div class="input-wrapper" style="margin-bottom: 4px;">
        <label style="font-size: 12px; margin-bottom: 2px;">Email Address</label>
        <div class="input-container">
          <input type="text" class="glassmorphism-input" name="email" id="email" value="{{ user_form.data.email }}" placeholder="Enter your email" style="padding: 6px 10px; font-size: 12px;">
        </div>
        {% if user_form.errors.email %}
          <ul class="field_errors">
            {% for error in user_form.errors.email %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
      
      <div class="input-wrapper" style="margin-bottom: 4px;">
        <label style="font-size: 12px; margin-bottom: 2px;">Password</label>
        <div class="input-container">
          <input type="password" class="glassmorphism-input" name="password" id="password" placeholder="Enter your password" style="padding: 6px 10px; font-size: 12px;">
        </div>
        {% if user_form.errors.password %}
          <ul class="field_errors">
            {% for error in user_form.errors.password %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
      
      <div class="input-wrapper" style="margin-bottom: 4px;">
        <label style="font-size: 12px; margin-bottom: 2px;">How did you hear about TOAI studio?</label>
        <div class="input-container">
          <select class="glassmorphism-input" name="how_find_us" id="how_find_us" style="padding: 6px 10px; font-size: 12px;">
            <option disabled value="" {% if not form.data.how_find_us %}selected{% endif %}>Select an option</option>
            {% for choice in found_us_options %}
              <option value="{{ choice.1 }}" {% if choice.1 == user_form.data.how_find_us %}selected{% endif %}>{{ choice.1 }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      
      <div class="input-wrapper" id="elaborateContainer" {% if user_form.data.how_find_us != elaborate %}style="display:none;"{% endif %} style="margin-bottom: 4px;"> 
        <label style="font-size: 12px; margin-bottom: 2px;">Please elaborate</label>
        <div class="input-container">
          <input class="glassmorphism-input" name="elaborate" id="elaborate" placeholder="Please elaborate" {% if user_form.data.how_find_us == elaborate %}value="{{ user_form.data.elaborate }}"{% endif %} style="padding: 6px 10px; font-size: 12px;">
        </div>
      </div>
      
      <div class="form-options" style="margin-bottom: 4px; margin-top: 2px;">
        <div class="checkbox-wrapper">
          <input name="allow_newsletters" id="allow_newsletters" type="hidden" value="{% if user_form.data.allow_newsletters == 'false' %}false{% else %}true{% endif %}">
          <input name="allow_newsletters_visual" id="allow_newsletters_visual" class="glassmorphism-checkbox"
                  type="checkbox" {% if user_form.data.allow_newsletters == 'false' %}{% else %}checked="checked{% endif %}"
                  onchange="document.getElementById('allow_newsletters').value=document.getElementById('allow_newsletters_visual').checked">
          <label for="allow_newsletters_visual" style="font-size: 11px;">Get the latest news from TOAI Studio</label>
        </div>
      </div>

      {% if form.non_field_errors %}
        {% for error in form.non_field_errors %}
          <p class="error">
            {{ error }}
          </p>
        {% endfor %}
      {% endif %}
      
      <button type="submit" class="glassmorphism-button" style="padding: 6px 16px; font-size: 12px; margin-top: 2px;">Create Account</button>
    </form>
  </div>
  
  <div class="text-wrapper" style="margin-top: 4px;">
    <p style="color: white; font-size: 11px; margin: 0;">Already have an account? <a href="{% url 'user-login' %}{% querystring %}" style="color: #667eea; text-decoration: none;">Log in</a></p>
  </div>
  <script>
    document.querySelector("#how_find_us").addEventListener('change', function(e) {
      const isOther = e.target.value == '{{ elaborate }}';
      document.querySelector("#elaborateContainer").style.display = isOther ? 'block' : 'none';
    });
  </script>
{% endblock %}

{% extends 'simple.html' %}
{% load i18n %}
{% load static %}
{% load filters %}


{% block head %}
<link rel="stylesheet" href="{{ settings.HOSTNAME }}{% static 'css/fonts.hellix.css' %}"/>
<link rel="stylesheet" href="{{ settings.HOSTNAME }}{% static 'css/custom-login.css' %}?v={{ timestamp|default:'1' }}"/>
<style>
.login_page_new_ui {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%), url('{{ settings.HOSTNAME }}{% static "images/login-bg.jpg" %}') center center / cover no-repeat !important;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const loginTab = document.querySelector('[data-tab="login"]');
  const signupTab = document.querySelector('[data-tab="signup"]');
  
  // Function to update active tab styling
  function updateActiveTab(activeTab) {
    // Remove active class from both tabs
    loginTab.classList.remove('active');
    signupTab.classList.remove('active');
    
    // Add active class to the clicked tab
    activeTab.classList.add('active');
  }
  
  if (loginTab) {
    loginTab.addEventListener('click', function(e) {
      e.preventDefault();
      updateActiveTab(loginTab);
      // Redirect to the login page
      const loginUrl = '{% url "user-login" %}';
      console.log('Redirecting to:', loginUrl);
      window.location.href = loginUrl;
    });
  }
  
  if (signupTab) {
    signupTab.addEventListener('click', function(e) {
      e.preventDefault();
      updateActiveTab(signupTab);
      // Redirect to the signup page
      const signupUrl = '{% url "user-signup" %}';
      console.log('Redirecting to:', signupUrl);
      window.location.href = signupUrl;
    });
  }
  
  // Set initial active state based on current page
  const currentPath = window.location.pathname;
  if (currentPath.includes('signup')) {
    updateActiveTab(signupTab);
  } else {
    updateActiveTab(loginTab);
  }
});
</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-129877673-1" nonce="{{request.csp_nonce}}"></script>
<script nonce="{{request.csp_nonce}}">
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-129877673-1');
</script>
{% endblock %}

{% block content %}
<script nonce="{{request.csp_nonce}}">
  window.APP_SETTINGS = window.APP_SETTINGS ?? {};
  window.APP_SETTINGS.collect_analytics = {{ settings.COLLECT_ANALYTICS|yesno:"true,false" }};

  // Log event to the server, if analytics are enabled
  // This is a fallback for when the __lsa global is not defined
  // Normally this is a part of our main bundle but these pages do not use the main bundle
  // and this allows us to log events from these pages
  const logEvent = (eventName, metadata = {}) => {
    if (!window.APP_SETTINGS?.collect_analytics) return;

    const payload = {
      ...metadata,
      event: eventName,
      url: window.location.href,
    };

    window.requestIdleCallback(() => {
      const params = new URLSearchParams({ __: JSON.stringify(payload) });
      const url = `/__lsa/?${params}`;
      try {
        if (navigator.sendBeacon) {
          navigator.sendBeacon(url);
        } else {
          const img = new Image();
          img.src = url;
        }
      } catch {
        // Ignore errors here
      }
    });
  };
  if (!window.__lsa) {
    window.__lsa = logEvent;
  }
</script>

<script nonce="{{request.csp_nonce}}">
  const gaClientIdTrackingIframe = (event) => {
    if (!window.APP_SETTINGS?.collect_analytics) return;
    
    const iframe = document.createElement("iframe");
    window.addEventListener("message", (message) => {
      if(message.source === iframe.contentWindow && message.data.gaClientId) {
        sessionStorage.setItem('ls_gaclient_id', message.data.gaClientId);
      }
    });
    const origin = window.location.origin;
    iframe.src = `https://labelstud.io/track/?event=${event}&origin=${origin}`;
    iframe.style.display = "none";
    iframe.style.visibility = "hidden";
    document.body.appendChild(iframe);
  }
</script>

<div class="login_page_new_ui">
  <!-- Glassmorphism Login Card -->
  <div class="glassmorphism-container">
    <div class="glassmorphism-card">
      <!-- Logo Section -->
      <div class="logo-section">
        <div class="logo-container">
          <img src="{% static 'images/toai-studio-logo.jpg' %}" alt="TOAI Studio" class="logo-image">
          <h1 class="logo-text">TOAI Studio</h1>
        </div>
      </div>
      
      <!-- Login/Signup Tabs -->
      <div class="auth-tabs">
        <a href="{% url 'user-login' %}" class="tab-button" data-tab="login">LOGIN</a>
        <a href="{% url 'user-signup' %}" class="tab-button" data-tab="signup">SIGN UP</a>
      </div>
      

      
      <!-- Login Form -->
      <div class="form-container" id="login-form-container">
        {% block user_content %}
      </div>
      

      
      <!-- Social Login -->
      <div class="social-login">
        <p class="social-text">Or continue with</p>
        <div class="social-buttons">
          <button class="social-button google">
            <span class="social-icon">G</span>
          </button>
          <button class="social-button apple">
            <span class="social-icon">üçé</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>



  {% endblock %}
{% endblock %}
